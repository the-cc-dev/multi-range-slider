!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.multiRange=e()}(this,function(){function t(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=isNaN(+e[s])||"string"!=typeof e[s]?e[s]:+e[s]);return t}function e(t){return t.toLocaleString(void 0,{maximumFractionDigits:1}).replace(".0","")}var s={groups:[],rangesPercentages:[]};return this.MultiRange=function(e,i){var n={};i="object"==typeof i?i:{},e&&t(n,e.dataset),this.settings=t({},this.defaults),this.settings=t(this.settings,n),this.settings=t(this.settings,i),this.delta=this.settings.max-this.settings.min,i.ticks&&(this.settings.tickStep=this.delta/i.ticks),this.state=t({},s),this.ranges=i.ranges||[this.settings.min+this.settings.tickStep,this.settings.max-this.settings.tickStep],this.id=Math.random().toString(36).substr(2,9),this.DOM={},t(this,new this.EventDispatcher),this.build(e),this.events.binding.call(this)},this.MultiRange.prototype={defaults:{minRange:1,tickStep:5,roundTicks:!0,step:1,min:0,max:100},EventDispatcher:function(){var t=document.createTextNode("");this.off=t.removeEventListener.bind(t),this.on=t.addEventListener.bind(t),this.trigger=function(e,s){if(e){var i=new CustomEvent(e,{detail:s});t.dispatchEvent(i)}}},build:function(t){var e=t.className.indexOf("multiRange")==-1?"multiRange "+t.className:t.className;this.DOM.scope=document.createElement("div"),this.DOM.scope.className=e,this.DOM.rangeWrap=document.createElement("div"),this.DOM.rangeWrap.className="multiRange__rangeWrap",this.DOM.rangeWrap.innerHTML=this.getRangesHTML(),this.DOM.ticks=document.createElement("div"),this.DOM.ticks.className="multiRange__ticks",this.DOM.ticks.innerHTML=this.getTicksHTML(),this.DOM.scope.appendChild(this.DOM.rangeWrap),this.DOM.scope.appendChild(this.DOM.ticks),this.DOM.groups=[],t.parentNode.replaceChild(this.DOM.scope,t)},getTicksHTML:function(){var t,s,i=this.delta/this.settings.tickStep,n="";for(s=0;s<=i;s++)t=+this.settings.min+this.settings.tickStep*s,this.settings.roundTicks&&(t=Math.round(t)),t=e(t),n+='<div data-value="'+t+'"></div>';return n},getRangesHTML:function(){var t,e=this,s="";return this.ranges.unshift(0),this.ranges[this.ranges.length-1]<this.settings.max&&this.ranges.push(this.settings.max),t=this.ranges,t.forEach(function(i,n){if(n!=t.length-1){var a=(i-e.settings.min)/e.delta*100,r=100-(t[n+1]-e.settings.min)/e.delta*100;a<0&&(a=0),e.state.rangesPercentages[n]=a,s+='<div data-idx="'+n+'" class="multiRange__range"                 style="left:'+a+"%; right:"+r+'%;">                <div class="multiRange__range__handle"></div>                <div class="multiRange__range__value">'+i.toFixed(1).replace(".0","")+"</div>            </div>"}}),s},groupValues2:function(){console.warn("------");var t,e,s,i,n=this,a=[],r=this.state.groups.slice(0),h=[],g=this.DOM.rangeWrap.querySelectorAll(".multiRange__range").length;for(this.state.groups.length=0,i=g;i-- >1;)(e=this.DOM.rangeWrap.children[i].querySelector(".multiRange__range__value"))&&a.push(e.getBoundingClientRect());for(i=a.length;i-- >1;){t=a[i].x+a[i].width>=a[i-1].x;var o=a.length-i,u=h[h.length-1];t?(u!=o&&h.push(o),h.push(o+1)):h.length&&(this.state.groups.push(h),h=[])}for(h.length&&this.state.groups.push(h),i=1;i<g;i++)this.DOM.rangeWrap.children[i].classList.toggle("hideValue",this.state.groups.toString().indexOf(i)!=-1);s=this.state.groups.toString()!=r.toString(),s&&this.DOM.groups&&this.DOM.groups.length&&(this.DOM.groups.forEach(function(t){t.parentNode.removeChild(t)}),this.DOM.groups.length=0),this.state.groups.forEach(function(t,e){var i;s&&(i=document.createElement("div"),i.className="multiRange__groupedValue",i.rel=t.toString(),n.DOM.groups.push(i),n.DOM.rangeWrap.appendChild(i)),i=n.DOM.groups[e],console.log(i)})},stateCleaup:function(){var e=this.state;this.state=t({},s),this.state.groups=e.groups,this.state.rangesPercentages=e.rangesPercentages},events:{binding:function(){this.DOM.rangeWrap.addEventListener("mousedown",this.events.callbacks.onMouseDown.bind(this)),this.DOM.scope.addEventListener("dragstart",function(t){return!1})},callbacks:{onMouseDown:function(t){var e=t.target;if(e&&"multiRange__range__handle, multiRange__range__value".indexOf(e.className)!=-1){this.DOM.currentSlice=e.parentNode;var s=this.DOM.scope.getBoundingClientRect(),i=this.DOM.currentSlice.previousElementSibling,n=this.DOM.currentSlice.nextElementSibling;this.state.offsetLeft=s.left,this.state.scopeWidth=s.width,i&&(i=i.querySelector(".multiRange__range__value").getBoundingClientRect(),this.state.previousSliceOffsetLeft=i.left+i.width),n&&(this.state.nextSliceOffsetLeft=n.querySelector(".multiRange__range__value").getBoundingClientRect().left),this.DOM.currentSlice.classList.add("grabbed"),this.DOM.currentSliceValue=this.DOM.currentSlice.querySelector(".multiRange__range__value"),document.body.classList.add("multiRange-grabbing"),this.events.onMouseUpFunc=this.events.callbacks.onMouseUp.bind(this),this.events.mousemoveFunc=this.events.callbacks.onMouseMove.bind(this),window.addEventListener("mouseup",this.events.onMouseUpFunc),window.addEventListener("mousemove",this.events.mousemoveFunc)}},onMouseUp:function(t){this.DOM.currentSlice.classList.remove("grabbed"),window.removeEventListener("mousemove",this.events.mousemoveFunc),window.removeEventListener("mouseup",this.events.onMouseUpFunc),document.body.classList.remove("multiRange-grabbing"),this.trigger("changed",{idx:+this.DOM.currentSlice.dataset.idx,value:this.ranges[this.DOM.currentSlice.dataset.idx],ranges:this.ranges}),this.DOM.currentSlice=null,this.stateCleaup()},onMouseMove:function(t){if(!this.DOM.currentSlice)return void window.removeEventListener("mouseup",this.events.onMouseUpFunc);if(!(t.clientX<this.offsetLeft||t.clientX>this.offsetLeft+this.scopeWidth)){var e,s=this,i=+this.DOM.currentSlice.dataset.idx,n=t.clientX-this.state.offsetLeft,a=n/this.state.scopeWidth*100,r=this.ranges[+this.DOM.currentSlice.dataset.idx-1],h=this.ranges[+this.DOM.currentSlice.dataset.idx+1];e=this.settings.min+this.delta/100*a,this.settings.step&&(e=Math.round(e/this.settings.step)*this.settings.step),e<r+this.settings.minRange&&(e=r+this.settings.minRange),e>h-this.settings.minRange&&(e=h-this.settings.minRange),e<this.settings.min+this.settings.minRange&&(e=this.settings.min+this.settings.minRange),e>this.settings.max-this.settings.minRange&&(e=this.settings.max-this.settings.minRange),a=(e-this.settings.min)/this.delta*100,this.state.rangesPercentages[i]=a,e!=this.state.currentSliceValue&&window.requestAnimationFrame(function(){s.DOM.currentSlice&&(s.DOM.currentSlice.style.left=a+"%",s.DOM.currentSliceValue.firstChild.nodeValue=e.toFixed(1).replace(".0",""),s.DOM.currentSlice.previousElementSibling.style.right=100-a+"%"),s.groupValues2()}),this.state.currentSliceValue=e,this.ranges[this.DOM.currentSlice.dataset.idx]=+e.toFixed(1),this.trigger("change",{idx:i,value:e,ranges:this.ranges})}}}}},Multi-range});